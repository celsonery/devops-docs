import{_ as a,c as e,o as s,a as o}from"./app-CT-lU83C.js";const n={},i=o(`<h1 id="migracao-de-configs-no-postgresql" tabindex="-1"><a class="header-anchor" href="#migracao-de-configs-no-postgresql"><span>Migração de Configs no PostgreSQL</span></a></h1><h2 id="objetivo" tabindex="-1"><a class="header-anchor" href="#objetivo"><span>Objetivo</span></a></h2><p>Reproduzir os <strong>mesmos usuários, senhas e permissões</strong> da instância PostgreSQL antiga em uma nova instância.</p><hr><h2 id="metodo-1-—-usar-pg-dumpall-para-exportar-apenas-objetos-globais" tabindex="-1"><a class="header-anchor" href="#metodo-1-—-usar-pg-dumpall-para-exportar-apenas-objetos-globais"><span>Método 1 — Usar <code>pg_dumpall</code> para Exportar Apenas Objetos Globais</span></a></h2><h3 id="_1-gerar-o-dump-global-da-instancia-antiga" tabindex="-1"><a class="header-anchor" href="#_1-gerar-o-dump-global-da-instancia-antiga"><span>1. Gerar o dump global da instância antiga</span></a></h3><p>No servidor original, execute:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">pg_dumpall <span class="token parameter variable">-U</span> postgres --globals-only <span class="token operator">&gt;</span> globals.sql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Esse comando exporta:</p><ul><li>Usuários (roles)</li><li>Senhas</li><li>Permissões</li><li>Tablespaces</li><li>Configurações específicas (<code>ALTER ROLE</code>, <code>ALTER DATABASE</code>)</li></ul><hr><h3 id="_2-importar-no-novo-servidor-instancia" tabindex="-1"><a class="header-anchor" href="#_2-importar-no-novo-servidor-instancia"><span>2. Importar no novo servidor/instância</span></a></h3><p>No servidor novo, execute (ajustando porta conforme necessário):</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">psql <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-h</span> localhost <span class="token parameter variable">-p</span> <span class="token number">5433</span> <span class="token parameter variable">-f</span> globals.sql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="cuidados" tabindex="-1"><a class="header-anchor" href="#cuidados"><span>Cuidados</span></a></h3><ul><li>Se o usuário <code>postgres</code> já existir na nova instância, remova a linha correspondente no <code>globals.sql</code> antes de importar.</li><li>O <code>pg_dumpall</code> inclui as senhas já criptografadas, preservando-as desde que o método de autenticação (<code>md5</code> ou <code>scram-sha-256</code>) esteja configurado.</li></ul><hr><h2 id="metodo-2-—-copiar-o-cluster-inteiro-com-rsync" tabindex="-1"><a class="header-anchor" href="#metodo-2-—-copiar-o-cluster-inteiro-com-rsync"><span>Método 2 — Copiar o cluster inteiro com <code>rsync</code></span></a></h2><p>Se <strong>as versões do PostgreSQL forem iguais</strong> e houver possibilidade de downtime, você pode copiar todo o cluster, preservando usuários, bancos e configurações.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> systemctl stop postgresql</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">rsync</span> <span class="token parameter variable">-av</span> /var/lib/postgresql/15/main/ /var/lib/postgresql/15-banco_a/</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> postgres:postgres /var/lib/postgresql/15-banco_a</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Após a cópia, ajuste o <code>postgresql.conf</code> e reinicie apenas a nova instância.</p><hr><h2 id="verificacao-pos-migracao" tabindex="-1"><a class="header-anchor" href="#verificacao-pos-migracao"><span>Verificação Pós-Migração</span></a></h2><p>Na nova instância, conecte-se como superusuário e liste os usuários:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line">\\du</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Teste o login de usuários antigos:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">psql <span class="token parameter variable">-U</span> usuario_teste <span class="token parameter variable">-h</span> localhost <span class="token parameter variable">-p</span> <span class="token number">5433</span> <span class="token parameter variable">-d</span> nome_do_banco</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><p><strong>Dica:</strong> Sempre faça backup antes de qualquer migração e teste em ambiente de homologação antes de aplicar em produção.</p>`,30),r=[i];function l(t,c){return s(),e("div",null,r)}const d=a(n,[["render",l],["__file","migrar-user-configs.html.vue"]]),u=JSON.parse('{"path":"/br/postgres/migrar-user-configs.html","title":"Migração de Configs no PostgreSQL","lang":"Português","frontmatter":{},"headers":[{"level":2,"title":"Objetivo","slug":"objetivo","link":"#objetivo","children":[]},{"level":2,"title":"Método 1 — Usar pg_dumpall para Exportar Apenas Objetos Globais","slug":"metodo-1-—-usar-pg-dumpall-para-exportar-apenas-objetos-globais","link":"#metodo-1-—-usar-pg-dumpall-para-exportar-apenas-objetos-globais","children":[{"level":3,"title":"1. Gerar o dump global da instância antiga","slug":"_1-gerar-o-dump-global-da-instancia-antiga","link":"#_1-gerar-o-dump-global-da-instancia-antiga","children":[]},{"level":3,"title":"2. Importar no novo servidor/instância","slug":"_2-importar-no-novo-servidor-instancia","link":"#_2-importar-no-novo-servidor-instancia","children":[]},{"level":3,"title":"Cuidados","slug":"cuidados","link":"#cuidados","children":[]}]},{"level":2,"title":"Método 2 — Copiar o cluster inteiro com rsync","slug":"metodo-2-—-copiar-o-cluster-inteiro-com-rsync","link":"#metodo-2-—-copiar-o-cluster-inteiro-com-rsync","children":[]},{"level":2,"title":"Verificação Pós-Migração","slug":"verificacao-pos-migracao","link":"#verificacao-pos-migracao","children":[]}],"git":{"updatedTime":1756395341000,"contributors":[{"name":"Celso Nery","email":"celso.nery@gmail.com","commits":1}]},"filePathRelative":"br/postgres/migrar-user-configs.md"}');export{d as comp,u as data};
